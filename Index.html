<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cloudblitz NACH EMI</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:#0b0f1a;
  color:#fff;
}

.header{
  text-align:center;
  padding:30px;
  background:#11163a;
}
.header h1{
  margin:0;
  color:#7b6cff;
}

.container{
  max-width:1100px;
  margin:auto;
  padding:25px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:25px;
}

.card{
  background:#14182a;
  padding:25px;
  border-radius:16px;
}

label{
  display:block;
  margin-top:12px;
  font-size:14px;
  color:#b7b7d6;
}

input,select{
  width:100%;
  padding:14px;
  margin-top:6px;
  border-radius:12px;
  border:none;
  background:#0e1222;
  color:#fff;
  font-size:15px;
}

/* Date picker fix */
input[type="date"]{
  border:2px solid #2d9cdb;
}
input[type="date"]::-webkit-calendar-picker-indicator{
  filter:invert(1);
}

.actions{
  margin-top:20px;
  display:flex;
  gap:15px;
}
button{
  flex:1;
  padding:14px;
  border:none;
  border-radius:12px;
  font-size:15px;
  cursor:pointer;
  font-weight:600;
}
.primary{ background:#7b6cff; color:#fff; }
.secondary{ background:#1f2340; color:#fff; }

/* Right side */
.summary{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
}
.box{
  background:#0e1222;
  padding:20px;
  border-radius:14px;
  text-align:center;
}
.box span{ color:#aaa; font-size:13px; }
.box strong{
  display:block;
  margin-top:8px;
  font-size:26px;
  color:#7b6cff;
}

.schedule{
  margin-top:20px;
  background:#0e1222;
  padding:20px;
  border-radius:14px;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th,td{
  padding:10px;
  border-bottom:1px solid #2a2e55;
  text-align:center;
}
th{ color:#7b6cff; }

.pdf-btn{
  max-width:1100px;
  margin:20px auto;
}

@media(max-width:900px){
  .container{ grid-template-columns:1fr; }
}
</style>
</head>

<body>

<div class="header">
  <h1>Cloudblitz NACH EMI Calculator</h1>
</div>

<div class="container">

<!-- INPUT -->
<div class="card">
  <label>Total Course Fee</label>
  <input type="number" id="totalFee" placeholder="60000">

  <label>Upfront Paid</label>
  <input type="number" id="upfront" placeholder="10000">

  <label>Admission Date</label>
  <input type="date" id="admissionDate">

  <label>Tenure (Months)</label>
  <select id="months">
    <option>2</option><option>3</option><option>4</option>
    <option>5</option><option selected>6</option>
    <option>7</option><option>8</option><option>9</option>
  </select>

  <div class="actions">
    <button class="primary" onclick="calculate()">Calculate</button>
    <button class="secondary" onclick="resetAll()">Reset</button>
  </div>
</div>

<!-- OUTPUT -->
<div id="screenArea">
  <div class="summary">
    <div class="box">
      <span>Loan Amount</span>
      <strong>₹ <span id="loanAmt">0</span></strong>
    </div>
    <div class="box">
      <span>Monthly EMI</span>
      <strong>₹ <span id="emiAmt">0</span></strong>
    </div>
  </div>

  <div class="schedule">
    <p><b>Total Months:</b> <span id="tenureShow">0</span></p>
    <p><b>Grand Total:</b> ₹ <span id="grandTotal">0</span></p>

    <h3>EMI Schedule</h3>
    <table>
      <thead>
        <tr>
          <th>EMI No</th>
          <th>EMI Date</th>
          <th>Month</th>
          <th>Amount (₹)</th>
        </tr>
      </thead>
      <tbody id="emiTable"></tbody>
    </table>
  </div>
</div>

</div>

<div class="pdf-btn">
  <button class="primary" onclick="downloadPDF()">Download PDF</button>
</div>

<!-- CLEAN PDF TEMPLATE -->
<div id="pdfTemplate" style="display:none;background:#fff;color:#000;padding:30px;">
  <h2 style="text-align:center;">Cloudblitz NACH EMI – Payment Schedule</h2>
  <hr>

  <p><b>Admission Date:</b> <span id="pdfAdmission"></span></p>
  <p><b>Total Course Fee:</b> ₹ <span id="pdfTotal"></span></p>
  <p><b>Upfront Paid:</b> ₹ <span id="pdfUpfront"></span></p>
  <p><b>Loan Amount:</b> ₹ <span id="pdfLoan"></span></p>
  <p><b>Monthly EMI:</b> ₹ <span id="pdfEmi"></span></p>
  <p><b>Total Tenure:</b> <span id="pdfTenure"></span> Months</p>

  <h3>EMI Schedule (Month Wise)</h3>

  <table border="1" width="100%" cellpadding="8" cellspacing="0">
    <thead>
      <tr>
        <th>EMI No</th>
        <th>EMI Date</th>
        <th>Month</th>
        <th>Amount (₹)</th>
      </tr>
    </thead>
    <tbody id="pdfTable"></tbody>
  </table>

  <h3 style="margin-top:20px;">Grand Total Paid: ₹ <span id="pdfGrand"></span></h3>
</div>

<script>
function calculate(){
  let total = Number(totalFee.value);
  let up = Number(upfront.value);
  let m = Number(months.value);
  let adm = admissionDate.value;
  emiTable.innerHTML = "";

  if(!total || !m || !adm) return;
  if(up > total) up = total;

  let loan = total - up;
  let emi = loan / m;

  loanAmt.innerText = loan.toFixed(0);
  emiAmt.innerText = emi.toFixed(0);
  tenureShow.innerText = m;
  grandTotal.innerText = total.toFixed(0);

  let ad = new Date(adm);
  let debitDay = ad.getDate() <= 20 ? 7 : 15;
  let d = new Date(ad);
  d.setMonth(d.getMonth()+1);
  d.setDate(debitDay);

  for(let i=1;i<=m;i++){
    let day = String(d.getDate()).padStart(2,"0");
    let mon = d.toLocaleString("en-US",{month:"short"});
    let yr = d.getFullYear();

    emiTable.innerHTML += `
      <tr>
        <td>${i}</td>
        <td>${day} ${mon} ${yr}</td>
        <td>${mon}</td>
        <td>${emi.toFixed(0)}</td>
      </tr>`;
    d.setMonth(d.getMonth()+1);
  }
}

function resetAll(){
  totalFee.value="";
  upfront.value="";
  admissionDate.value="";
  months.value="6";
  emiTable.innerHTML="";
  loanAmt.innerText=0;
  emiAmt.innerText=0;
  tenureShow.innerText=0;
  grandTotal.innerText=0;
}

function downloadPDF(){
  pdfAdmission.innerText = admissionDate.value;
  pdfTotal.innerText = totalFee.value;
  pdfUpfront.innerText = upfront.value;
  pdfLoan.innerText = loanAmt.innerText;
  pdfEmi.innerText = emiAmt.innerText;
  pdfTenure.innerText = tenureShow.innerText;
  pdfGrand.innerText = grandTotal.innerText;
  pdfTable.innerHTML = emiTable.innerHTML;

  html2pdf().from(document.getElementById("pdfTemplate")).set({
    margin:10,
    filename:"Cloudblitz_NACH_EMI_Schedule.pdf",
    html2canvas:{scale:2},
    jsPDF:{format:"a4", orientation:"portrait"}
  }).save();
}
</script>

</body>
</html>
